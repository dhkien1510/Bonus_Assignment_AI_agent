services:
  prestashop_mysql:
    # TODO: Thay bằng image của bạn sau khi push lên Docker Hub
    # image: yourdockerhub/prestashop_mysql:v1
    image: mysql:8.4
    container_name: prestashop_mysql
    environment:
      MYSQL_ROOT_PASSWORD: prestashop
      MYSQL_DATABASE: prestashop
      MYSQL_USER: prestashop
      MYSQL_PASSWORD: prestashop
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-pprestashop"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 30s
    networks:
      - prestashop_network

  prestashop_app:
    # TODO: Thay bằng image của bạn sau khi push lên Docker Hub
    # image: yourdockerhub/prestashop_app:v1
    image: prestashop/prestashop:8-apache
    container_name: prestashop_app
    depends_on:
      prestashop_mysql:
        condition: service_healthy
    ports:
      - "8001:80"
    environment:
      - DB_SERVER=prestashop_mysql
      - DB_NAME=prestashop
      - DB_USER=prestashop
      - DB_PASSWD=prestashop
      - PS_DOMAIN=localhost:8001
      - PS_FOLDER_ADMIN=admin-dev
      - PS_INSTALL_AUTO=0
      - PS_ERASE_DB=0
      - ADMIN_MAIL=demo@prestashop.com
      - ADMIN_PASSWD=Correct Horse Battery Staple
      - PS_COUNTRY=us
      - PS_LANGUAGE=en
    healthcheck:
      test: ["CMD-SHELL", "curl -sf http://localhost/ > /dev/null || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 60s
    networks:
      - prestashop_network

  maildev:
    image: maildev/maildev
    container_name: prestashop_maildev
    ports:
      - "1025:1025"
      - "1081:1080"
    networks:
      - prestashop_network

networks:
  prestashop_network:
    driver: bridge
